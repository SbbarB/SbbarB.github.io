<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component Position Diagnostic</title>
    <style>
        body {
            margin: 0;
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
        }
        #output {
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .component {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
        }
    </style>
</head>
<body>
    <div id="output">Loading model and analyzing components...</div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        const output = document.getElementById('output');
        let log = '';

        function print(msg) {
            log += msg + '\n';
            output.innerHTML = log;
            console.log(msg);
        }

        const loader = new GLTFLoader();
        loader.load('record_player_for_vinyls.glb', (gltf) => {
            const model = gltf.scene;

            // Center the model like in main file
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            model.position.sub(center);
            model.position.y += size.y / 2;

            print('=== COMPONENT POSITION ANALYSIS ===\n');

            const componentCategories = {
                'Cylinder003_TapeRecorder_0': { order: 1, name: 'Tonearm Pivot' },
                'Cylinder005_TapeRecorder_0': { order: 4, name: 'Spindle' },
                'Cylinder002_TapeRecorder_0': { order: 6, name: 'Tonearm' },
                'Cylinder001_TapeRecorder_0': { order: 2, name: 'Platter Base' },
                'Cylinder_TapeRecorder_0': { order: 3, name: 'Turntable Platter' },
                'Cube003_TapeRecorder_0': { order: 2, name: 'Control Mount' }
            };

            const components = [];

            model.traverse((child) => {
                if (child.isMesh) {
                    const category = componentCategories[child.name];

                    if (category) {
                        const worldPos = new THREE.Vector3();
                        child.getWorldPosition(worldPos);

                        const meshBox = new THREE.Box3().setFromObject(child);
                        const meshSize = meshBox.getSize(new THREE.Vector3());

                        components.push({
                            name: category.name,
                            meshName: child.name,
                            order: category.order,
                            worldPos: worldPos,
                            box: meshBox,
                            size: meshSize
                        });
                    }
                }
            });

            // Sort by X position (front to back)
            components.sort((a, b) => a.worldPos.z - b.worldPos.z);

            print('Components sorted by Z position (front to back):\n');
            components.forEach((comp, i) => {
                print(`[${i + 1}] ${comp.name}`);
                print(`    Mesh: ${comp.meshName}`);
                print(`    Layer Order: ${comp.order}`);
                print(`    World Position: (${comp.worldPos.x.toFixed(2)}, ${comp.worldPos.y.toFixed(2)}, ${comp.worldPos.z.toFixed(2)})`);
                print(`    Size: ${comp.size.x.toFixed(2)} x ${comp.size.y.toFixed(2)} x ${comp.size.z.toFixed(2)}`);
                print(`    Bottom Y: ${comp.box.min.y.toFixed(2)}`);
                print('');
            });

            print('\n=== INTERPRETATION ===\n');
            print('Based on Z position (assuming negative Z is front):');
            print(`  Most forward component: ${components[0].name}`);
            print(`  Middle component: ${components[1].name}`);
            print(`  Most rearward component: ${components[2].name}`);
            print('\nThe "small twistable knob" should be the most forward.');
            print('The "base that holds needle arm" should be behind it.');

        }, undefined, (error) => {
            print('ERROR: ' + error.message);
        });
    </script>
</body>
</html>
